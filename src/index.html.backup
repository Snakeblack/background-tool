<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Fondos WebGL (OKLCH + Shaders)</title>
    
    <!-- Estilos externos -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <!-- Botón de Toggle (oculto cuando paneles visibles) -->
    <button id="toggle-panels-btn" class="toggle-panels-btn" title="Mostrar paneles">
        <span class="toggle-icon">☰</span>
    </button>

    <!-- Panel Lateral Izquierdo: Controles Generales -->
    <div id="left-panel" class="side-panel left-panel">
        <div class="panel-header">
            <h2 class="panel-title">Configuración</h2>
            <div class="panel-buttons">
                <button id="minimize-left-panel" class="panel-btn" title="Minimizar">−</button>
                <button id="close-left-panel" class="panel-btn" title="Cerrar">✕</button>
            </div>
        </div>
        
        <div class="panel-content">
            <!-- Selector de Tipo de Fondo -->
            <div class="control-section">
                <h3 class="section-title">Tipo de Fondo</h3>
                <label for="shader-type" class="block text-sm font-medium text-gray-300 mb-2">Shader</label>
                <select id="shader-type" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="fragment-shader-liquid">Líquido (Ruido FBM)</option>
                    <option value="fragment-shader-stripes">Rayas (Seno/Coseno)</option>
                </select>
            </div>

            <!-- Controles Generales -->
            <div class="control-section">
                <button class="collapsible-header" id="general-controls-header">
                    <span class="collapse-icon">▼</span>
                    <span>Controles Generales</span>
                </button>
                <div class="collapsible-content" id="general-controls-content">
                    <div class="control-item">
                        <label for="speed" class="text-sm font-medium text-gray-300">
                            Velocidad Global: <span id="speed-value">0.2</span>
                        </label>
                        <input type="range" id="speed" min="0.01" max="1.0" step="0.01" value="0.2" class="w-full">
                    </div>
                </div>
            </div>

            <!-- Controles Específicos del Shader -->
            <div class="control-section">
                <button class="collapsible-header" id="shader-controls-header">
                    <span class="collapse-icon">▼</span>
                    <span>Controles Específicos</span>
                </button>
                <div class="collapsible-content" id="shader-controls-content">
                    <!-- Controles para Líquido -->
                    <div id="liquid-controls" class="control-item">
                        <label for="zoom" class="text-sm font-medium text-gray-300">
                            Zoom/Complejidad: <span id="zoom-value">4.0</span>
                        </label>
                        <input type="range" id="zoom" min="1.0" max="10.0" step="0.1" value="4.0" class="w-full">
                    </div>
                    
                    <!-- Controles para Rayas (oculto por defecto) -->
                    <div id="stripes-controls" style="display: none;">
                        <div class="control-item">
                            <label for="stripe-width" class="text-sm font-medium text-gray-300">
                                Grosor Rayas: <span id="stripe-width-value">10.0</span>
                            </label>
                            <input type="range" id="stripe-width" min="1.0" max="50.0" step="0.1" value="10.0" class="w-full">
                        </div>
                        <div class="control-item">
                            <label for="stripe-speed" class="text-sm font-medium text-gray-300">
                                Velocidad Rayas: <span id="stripe-speed-value">0.5</span>
                            </label>
                            <input type="range" id="stripe-speed" min="0.1" max="3.0" step="0.05" value="0.5" class="w-full">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel Lateral Derecho: Colores -->
    <div id="right-panel" class="side-panel right-panel">
        <div class="panel-header">
            <h2 class="panel-title">Colores (OKLCH)</h2>
            <div class="panel-buttons">
                <button id="minimize-right-panel" class="panel-btn" title="Minimizar">−</button>
                <button id="close-right-panel" class="panel-btn" title="Cerrar">✕</button>
            </div>
        </div>
        
        <div class="panel-content">
            <!-- Color 1 -->
            <div class="control-section">
                <button class="collapsible-header" id="color1-header">
                    <span class="collapse-icon">▼</span>
                    <span>Color 1</span>
                    <div id="color-preview-1" class="color-preview-inline"></div>
                </button>
                <div class="collapsible-content" id="color1-content">
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Luz (L): <span id="c1-l-val">0.7</span></label>
                        <input type="range" id="c1-l" min="0.1" max="1.0" step="0.01" value="0.7" class="oklch-slider w-full" data-color="1" data-channel="l">
                    </div>
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Croma (C): <span id="c1-c-val">0.25</span></label>
                        <input type="range" id="c1-c" min="0.0" max="0.4" step="0.005" value="0.25" class="oklch-slider w-full" data-color="1" data-channel="c">
                    </div>
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Tono (H): <span id="c1-h-val">330</span></label>
                        <input type="range" id="c1-h" min="0" max="360" step="1" value="330" class="oklch-slider w-full" data-color="1" data-channel="h">
                    </div>
                </div>
            </div>

            <!-- Color 2 -->
            <div class="control-section">
                <button class="collapsible-header" id="color2-header">
                    <span class="collapse-icon">▼</span>
                    <span>Color 2</span>
                    <div id="color-preview-2" class="color-preview-inline"></div>
                </button>
                <div class="collapsible-content" id="color2-content">
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Luz (L): <span id="c2-l-val">0.6</span></label>
                        <input type="range" id="c2-l" min="0.1" max="1.0" step="0.01" value="0.6" class="oklch-slider w-full" data-color="2" data-channel="l">
                    </div>
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Croma (C): <span id="c2-c-val">0.3</span></label>
                        <input type="range" id="c2-c" min="0.0" max="0.4" step="0.005" value="0.3" class="oklch-slider w-full" data-color="2" data-channel="c">
                    </div>
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Tono (H): <span id="c2-h-val">280</span></label>
                        <input type="range" id="c2-h" min="0" max="360" step="1" value="280" class="oklch-slider w-full" data-color="2" data-channel="h">
                    </div>
                </div>
            </div>

            <!-- Color 3 -->
            <div class="control-section">
                <button class="collapsible-header" id="color3-header">
                    <span class="collapse-icon">▼</span>
                    <span>Color 3</span>
                    <div id="color-preview-3" class="color-preview-inline"></div>
                </button>
                <div class="collapsible-content" id="color3-content">
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Luz (L): <span id="c3-l-val">0.8</span></label>
                        <input type="range" id="c3-l" min="0.1" max="1.0" step="0.01" value="0.8" class="oklch-slider w-full" data-color="3" data-channel="l">
                    </div>
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Croma (C): <span id="c3-c-val">0.2</span></label>
                        <input type="range" id="c3-c" min="0.0" max="0.4" step="0.005" value="0.2" class="oklch-slider w-full" data-color="3" data-channel="c">
                    </div>
                    <div class="control-item">
                        <label class="text-xs text-gray-400">Tono (H): <span id="c3-h-val">150</span></label>
                        <input type="range" id="c3-h" min="0" max="360" step="1" value="150" class="oklch-slider w-full" data-color="3" data-channel="h">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shaders GLSL -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        void main() {
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>

    <!-- Fragment Shader: LÍQUIDO (FBM) -->
    <script id="fragment-shader-liquid" type="x-shader/x-fragment">
        precision mediump float;
        
        uniform vec2 u_resolution;
        uniform float u_time;
        uniform vec3 u_color1;
        uniform vec3 u_color2;
        uniform vec3 u_color3;
        uniform float u_speed;
        uniform float u_zoom;

        float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
        }

        float noise(vec2 st) {
            vec2 i = floor(st);
            vec2 f = fract(st);
            float a = random(i);
            float b = random(i + vec2(1.0, 0.0));
            float c = random(i + vec2(0.0, 1.0));
            float d = random(i + vec2(1.0, 1.0));
            vec2 u = f * f * (3.0 - 2.0 * f);
            return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.y * u.x;
        }

        float fbm(vec2 st) {
            float value = 0.0;
            float amplitude = 0.5;
            for (int i = 0; i < 6; i++) {
                value += amplitude * noise(st);
                st *= 2.0;
                amplitude *= 0.5;
            }
            return value;
        }

        void main() {
            vec2 uv = gl_FragCoord.xy / u_resolution.xy;
            uv.x *= u_resolution.x / u_resolution.y;
            
            float time = u_time * u_speed * 0.1;
            float n1 = fbm(uv * u_zoom + vec2(time, time));
            float n2 = fbm(uv * u_zoom * 0.8 + vec2(time * 1.2, time * 0.8));

            vec3 mix1 = mix(u_color1, u_color2, n1);
            vec3 finalColor = mix(mix1, u_color3, n2);
            
            gl_FragColor = vec4(finalColor, 1.0);
        }
    </script>

    <!-- Fragment Shader: RAYAS (Seno/Coseno) -->
    <script id="fragment-shader-stripes" type="x-shader/x-fragment">
        precision mediump float;
        
        uniform vec2 u_resolution;
        uniform float u_time;
        uniform vec3 u_color1;
        uniform vec3 u_color2;
        uniform vec3 u_color3;
        uniform float u_speed;
        uniform float u_stripe_width;
        uniform float u_stripe_speed;

        void main() {
            vec2 uv = gl_FragCoord.xy / u_resolution.xy;
            uv.x *= u_resolution.x / u_resolution.y;
            
            float time = u_time * u_speed * 0.1;
            float n1 = (sin( (uv.x + time * u_stripe_speed) * u_stripe_width) + 1.0) / 2.0;
            float n2 = (cos( (uv.y - time * u_stripe_speed * 0.5) * u_stripe_width * 0.5) + 1.0) / 2.0;

            vec3 mix1 = mix(u_color1, u_color2, n1);
            vec3 finalColor = mix(mix1, u_color3, n2);
            
            gl_FragColor = vec4(finalColor, 1.0);
        }
    </script>

    <!-- Librerías externas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/culori@3"></script>
    
    <!-- Script principal -->
    <script type="module" src="main.js"></script>
</body>
</html>
